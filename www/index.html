<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="format-detection" content="telephone=no" />
		<meta name="msapplication-tap-highlight" content="no" />
		<!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
		<meta name='viewport' content='width=device-width, initial-scale=1, user-scalable=no' />
		<meta http-equiv="Content-Security-Policy" content="content_security_policy": "script-src 'self' https://maps.googleapis.com https://maps.gstatic.com; object-src 'self'" />
		<title>GPS Countdown</title>
		
		
		<style>
		#map {
        	height: 100px;
		}	
		</style>
		
		
		
		<link rel="stylesheet" type="text/css" href="css/index.css" />
		<link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css">
		
		<script src="js/jquery-1.10.2.min.js"></script>
		<script src="js/jquery.mobile-1.4.5.min.js"></script>
    
	</head>
	<body onhashchange="refreshMap()">
		<div data-role="page" id="home">
			<div data-role="header">
				<h1 text-align="center">
					<img src="images/logo.png" alt="Logo" width="400">
					<a href="#defaultpanel"><img src="images/3lines.png" alt="Logo" width="20" /></a>
				</h1>
			</div>

			<div role="main" class="ui-content">
				<h1 id="welcome"></h1>
				<h4>Please follow the instructions underneath to set your time and location.</h4>
				<p align="center">
					<a href="#timer"><img src="images/time.png" alt="Logo" width="80" align="center"></a>
				</p>
			</div>

			<div data-role="footer">
				<h1>&copy;2016 GPS Countdown</h1>
			</div>

			<!-- defaultpanel  -->
			<div data-role="panel" id="defaultpanel" data-theme="b">
				<div class="panel-content">
					<h3>Default panel options</h3>
					<p><a href="#home">Home</a></p>
					<p><a href="#timer">Timer</a></p>
					<p>&nbsp;</p>
					<p><a href="#about">About</a></p>
					<p><a href="#contact">Contact</a></p>
					<p>&nbsp;</p>
					<p>Swipe to close</p>
					<strong><p>Version 1.0</p></strong>
					<p>&nbsp;</p>
					<p><img src="images/whitelogo.png" alt="Logo" width="150"></p>

					<a href="#demo-links" data-rel="close" data-role="button" data-theme="a" data-icon="delete" data-inline="true">Close panel</a>
				</div><!-- /content wrapper for padding -->
			</div><!-- /defaultpanel -->
		</div>
		
		<div data-role="page" id="timer">
			<div data-role="header">
				<h1 text-align="center">
					<img src="images/logo.png" alt="Logo" width="200">
					<a href="#defaultpanel"><img src="images/3lines.png" alt="Logo" width="20" /></a>
				</h1>
			</div>

			<div role="main" class="ui-content">
				<h4>Set a time you want to wish to be back at</h4>
				<form>
					<div id="jsalarmclock">
						<div><span>Hour<select></select></span> <span>Minutes<select></select></span> </div>
						<p>Set notification time</p>
						<select id="notificationdelay"></select>
						<input type="button" value="Set alarm" id="submitbutton" /> <input type="reset" value="Clear alarm" id="resetbutton" />
					</div>
				</form>
				<p>&nbsp;</p>
				<hr>
				<p>&nbsp;</p>
				<a href="#map"><button>Continue to map</button></a>
				<p>&nbsp;</p>
			</div>

			<div data-role="footer">
				<h1>&copy;2016 GPS Countdown</h1>
			</div>

			<!-- defaultpanel  -->
			<div data-role="panel" id="defaultpanel" data-theme="b">
				<div class="panel-content">
					<h3>Default panel options</h3>
					<p><a href="#home">Home</a></p>
					<p><a href="#timer">Timer</a></p>
					<p>&nbsp;</p>
					<p><a href="#about">About</a></p>
					<p><a href="#contact">Contact</a></p>
					<p>&nbsp;</p>
					<p>Swipe to close</p>
					<strong><p>Version 1.0</p></strong>
					<p>&nbsp;</p>
					<p align="center"><a href="#timer"><img src="images/time.png" alt="Logo" width="80" align="center"></a></p>

					<a href="#demo-links" data-rel="close" data-role="button" data-theme="a" data-icon="delete" data-inline="true">Close panel</a>
				</div><!-- /content wrapper for padding -->
			</div><!-- /defaultpanel -->
		</div>

		<div data-role="page" id="map">
			<div data-role="header">
				<h1 text-align="center">
					<img src="images/logo.png" alt="Logo" width="200">
					<a href="#defaultpanel"><img src="images/3lines.png" alt="Logo" width="20" /></a>
				</h1>
			</div>

			<div role="main" class="ui-content">
				<h1>Map here</h1>
				    <div id="map"></div>

			</div>

			<div data-role="footer">
				<h1>&copy;2016 GPS Countdown</h1>
			</div>

			<!-- defaultpanel  -->
			<div data-role="panel" id="defaultpanel" data-theme="b">
				<div class="panel-content">
					<h3>Default panel options</h3>
					<p><a href="#home">Home</a></p>
					<p><a href="#timer">Timer</a></p>
					<p>&nbsp;</p>
					<p><a href="#about">About</a></p>
					<p><a href="#contact">Contact</a></p>
					<p>&nbsp;</p>
					<p>Swipe to close</p>
					<strong><p>Version 1.0</p></strong>
					<p>&nbsp;</p>
					<p align="center"><a href="#timer"><img src="images/time.png" alt="Logo" width="80" align="center"></a></p>

					<a href="#demo-links" data-rel="close" data-role="button" data-theme="a" data-icon="delete" data-inline="true">Close panel</a>
				</div><!-- /content wrapper for padding -->
			</div><!-- /defaultpanel -->
		</div>

		<div data-role="page" id="about">
			<div data-role="header">
				<h1 text-align="center">
					<img src="images/logo.png" alt="Logo" width="200">
					<a href="#defaultpanel"><img src="images/3lines.png" alt="Logo" width="20" /></a>
				</h1>
			</div>

			<div role="main" class="ui-content">
				<h1>About Geolocation</h1>
				<h4>Simplify your everyday life with Geolocation.</h4>
				<p>&nbsp;</p>
				<p>The GPS Countdown application allows you to set a location such as car parking and a time which you need to get back to that vehicle at.</p>
				<p>Once you set your location and time to get back to the set location, the application runs in the background with a notification appearing 15 minutes before you are needed back at that set location such as when your car parking expires. The application sets directions back to that original location, as a result of the application being based on Google Maps, live traffic information is available to ensure you get back in time. </p>
				<p>The Geolocation app enables you to set your location and the time you need to be back at your car, simply go and you will be notified when to return back to the vehicle and the best route back.</p>
				<p>Why choose the app?</p>
				<p><li>Easily open the app with a simplistic user interface</li></p>
				<p><li>Set a location of where you parked your vehicle</li></p>
				<p><li>Set a time you wish to return back to the set location.</li></p>
				<p><li>A audio, vibrating and visual notification will inform you when you need to be back at the set location.</li></p>
				<p>&nbsp;</p>
				<p>&nbsp;</p>
				<p>Continuing usage of GPS technologies running in the background could potentially lead to battery life shortening.</p>
				<p></p>
			</div>

			<div data-role="footer">
				<h1>&copy;2016 GPS Countdown</h1>
			</div>

			<!-- defaultpanel  -->
			<div data-role="panel" id="defaultpanel" data-theme="b">
				<div class="panel-content">
					<h3>Default panel options</h3>
					<p><a href="#home">Home</a></p>
					<p><a href="#timer">Timer</a></p>
					<p>&nbsp;</p>
					<p><a href="#about">About</a></p>
					<p><a href="#contact">Contact</a></p>
					<p>&nbsp;</p>
					<p>Swipe to close</p>
					<strong><p>Version 1.0</p></strong>
					<p>&nbsp;</p>
					<p align="center"><a href="#timer"><img src="images/time.png" alt="Logo" width="80" align="center"></a></p>

					<a href="#demo-links" data-rel="close" data-role="button" data-theme="a" data-icon="delete" data-inline="true">Close panel</a>
				</div><!-- /content wrapper for padding -->
			</div><!-- /defaultpanel -->
		</div>

		<div data-role="page" id="contact">
			<div data-role="header">
				<h1 text-align="center">
					<img src="images/logo.png" alt="Logo" width="200">
					<a href="#defaultpanel"><img src="images/3lines.png" alt="Logo" width="20" /></a>
				</h1>
			</div>

			<div role="main" class="ui-content">
				<h1>Contact us</h1>
				<h4>Need any assistance? Found an error? We'd love to hear from you!</h4>
				<form id="contact_form" action="#" method="POST" enctype="multipart/form-data">
					<div class="row">
						<input id="name" class="input" placeholder="Your name" name="name" type="text" value="" size="30" /><br />
					</div>
					<div class="row">
						<input id="email" class="input" name="email" placeholder="Email address" type="text" value="" size="30" /><br />
					</div>
					<div class="row">
						<textarea id="message" class="input" placeholder="Message" name="message" rows="7" cols="30"></textarea><br />
					</div>
					<input id="submit_button" type="submit" value="Send email" />
				</form>
				<p>&nbsp;</p>
				<hr>
				<p>&nbsp;</p>
				<h3>Address information</h3>
				<p>Email address: contact@gpscountdown.com</p>
				<p>&nbsp;</p>
				<p>32 Example Road</p>
				<p>Springfield</p>
				<p>SP8 1LC</p>

				<p>&nbsp;</p>
			</div>

			<div data-role="footer">
				<h1>&copy;2016 GPS Countdown</h1>
			</div>

			<!-- defaultpanel  -->
			<div data-role="panel" id="defaultpanel" data-theme="b">
				<div class="panel-content">
					<h3>Default panel options</h3>
					<p><a href="#home">Home</a></p>
					<p><a href="#timer">Timer</a></p>
					<p>&nbsp;</p>
					<p><a href="#about">About</a></p>
					<p><a href="#contact">Contact</a></p>
					<p>&nbsp;</p>
					<p>Swipe to close</p>
					<strong><p>Version 1.0</p></strong>
					<p>&nbsp;</p>
					<p align="center"><a href="#timer"><img src="images/time.png" alt="Logo" width="80" align="center"></a></p>

					<a href="#demo-links" data-rel="close" data-role="button" data-theme="a" data-icon="delete" data-inline="true">Close panel</a>
				</div><!-- /content wrapper for padding -->
			</div><!-- /defaultpanel -->
		</div>

		<script type="text/javascript">
			function start() {
				$('#jsalarmclock select')[0].id = 'hour';
				$('#jsalarmclock select')[1].id = 'minute';

				for (var i = 0; i < 60; i++) {
					if (i < 24)
						$('#hour').append($('<option>', {
							value: i,
							text: pad(i),
							selected: (new Date()).getHours() === i
						}));

					$('#minute').append($('<option>', {
						value: i,
						text: pad(i),
						selected: (new Date()).getMinutes() === i
					}));
					
					$('#notificationdelay').append($('<option>', {
						value: i +1,
						text: i +1
					}));
				}
			}

			function pad(num) {
				return (num < 10) ? "0" + num : num;
			}

			/*function alarmAction() {
				//Alarm action goes here//
				cordova.plugins.notification.local.schedule({
					title: "Car parking nearly up",
					text: "Car parking up in 10 minutes, use the app to make your way back to your vehicle.",
				});
			}*/

			function setNotification(time) {
				cordova.plugins.notification.local.schedule({
					title: "Car parking nearly up",
					text: "Car parking up in 10 minutes, use the app to make your way back to your vehicle.",
					at: time
				});
			}

			$('#submitbutton').click(function(e) {
				e.preventDefault();
				$('#jsalarmclock select').attr('disabled','disabled');

				var t = new Date();
				t.setHours($('#hour').val());
				t.setMinutes($('#minute').val());
				t.setSeconds(0);
				if (t <= (new Date()))
					t.setDate(t.getDate() + 1);

				/*timer = setInterval(function() {
					var now = new Date();
					if (now.getHours() == $('#hour').val() && now.getMinutes() == $('#minute').val())
					{
						clearInterval(timer);
						alarmAction();
					}
				}, 1000);*/
				
				var min = parseInt( $('#notificationdelay').val());
				var ms = min * 60000;
				var d = new Date(t - ms);
				if (d < (new Date())) d.setDate(d.getDate() + 1);
				setNotification(d);
				alert('Time set');
			});

			$('#resetbutton').click(function() {
				cordova.plugins.notification.local.cancelAll();
			});
		</script>
		<script type="text/javascript" src="cordova.js"></script>
		<script type="text/javascript" src="js/index.js"></script>
		<script type="text/javascript">
			app.initialize();

			var myDate = new Date();

			// Hour is before noon
			if (myDate.getHours() < 12)
				$('#welcome').html("Good Morning!");

			// Hour is from noon to 5pm (actually to 5:59 pm)
			else if (myDate.getHours() >= 12 && myDate.getHours() <= 17)
				$('#welcome').html("Good Afternoon!");

			// The hour is after 5pm, so it is between 6pm and midnight
			else if (myDate.getHours() > 17 && myDate.getHours() <= 24)
				$('#welcome').html("Good Evening!");

			// The hour is not between 0 and 24, so something is wrong
			else
				$('#welcome').html("Welcome!");
				
		
		</script>
		
		
		
		

  <script>
      // Note: This example requires that you consent to location sharing when
      // prompted by your browser. If you see the error "The Geolocation service
      // failed.", it means you probably did not give permission for the browser to
      // locate you.
      
      var pos = {lat: -34.397, lng: 150.644};
      var map = null;
      var infoWindow = null;

      function initMap() {
        
        //google.maps.event.trigger(map, 'resize');
        alert(pos.lat + " " + pos.lng);
        
        map = new google.maps.Map(document.getElementById('map'), {
          center: pos,
          zoom: 18
        });
        infoWindow = new google.maps.InfoWindow({map: map});

        // Try HTML5 geolocation.
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(function(position) {
            pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            
            

            infoWindow.setPosition(pos);
            infoWindow.setContent('You have parked here.');
            map.setCenter(pos);
          }, function() {
            handleLocationError(true, infoWindow, map.getCenter());
          });
        } else {
          // Browser doesn't support Geolocation
          handleLocationError(false, infoWindow, map.getCenter());
        }
      }

      function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
                              'Error: The Geolocation service failed.' :
                              'Error: Your browser doesn\'t support geolocation.');
      }
      
      function refreshMap()
      {
      	if (location.hash.substr(1) === "map")
      	{
      		setTimeout(function() {
      			if (localStorage.getItem("carlocation") === null) {
	      			// First time, want to set the location
	      			 window.localStorage.setItem("carlocation",pos);
	      		}
	      		else {
	      			// Returning to the map, so want to get the users loccation.
	      			   pos = window.localStorage.getItem("carlocation");
	      		}
	      		
	      		alert(".");
	      		alert(JSON.stringify(infoWindow));
	      		
      		        infoWindow.setPosition(pos);
		        infoWindow.setContent('You have parked here.');
    		        map.setCenter(pos);
      			google.maps.event.trigger(map, 'resize');
      		}, 500);
      	}
      }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB4uyz3-pk1FffmFqgilBK1Hf4Me6Sd_wY&callback=initMap">
    </script>
	</body>
</html>
